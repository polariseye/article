golang代码规范
----------------------------------------------------------------------

## 代码格式化 ##

 统一使用`gofmt`工具进行格式化

## 包依赖管理 ##

现在使用原始的方式，暂未使用`gomodule`

# 命名规范

**普通命名规则**

* 使用驼峰命名方式，每个单词首字母小写
* 包内全局变量，struct的内部字段均以`_`开头
* 非public函数以`_`开头
* 包名首字母小写，且使用驼峰命名，例如:dbServer

````
	package main
	
	var _Date = "2021-03-24" // 包内全局变量以_开头

	func main(){
		fmt.Println(_Date,":",_GetName())
	}
	
	func _GetName()string{ // 内部函数，以 _开头
		var name="nihao" // 内部变量首字母小写
	
		return name
	}
````

**常量命名**

* 内部常量以`_Con`开头
* 外部可访问常量以`Con`开头

````
	package main
	
	const _ConSecret= "hell world" // 内部常量使用_Con开头 
	const ConName="nihao" // 外部可访问变量使用Con开头 

	func main(){
		fmt.Println(ConName, " secret:",_ConSecret)
	}
````

# 注释规范

struct注释规范
````

/*
	钱包模型对象
*/
type WalletModel struct {
	Id                    bson.ObjectId `bson:"_id"`
	WalletId              int32         `bson:"WalletId"`              // 钱包Id,同一个钱包会用于多个币种
	CoinId                uint32        `bson:"CoinId"`                // 币种Id
	CreatorId             bson.ObjectId `bson:"CreatorId"`             // 创建人Id
	ChainAccountAddr      string        `bson:"ChainAccountAddr"`      // 钱包链上地址Id
	Amount                float64       `bson:"Amount"`                // 钱包余额
	ActualAmount          string        `bson:"ActualAmount"`          // 钱包余额 ,实际余额
	FinishedTransactionId int64         `bson:"FinishedTransactionId"` // 已完成的交易Id
	AmountLastUpdateTime  int64         `bson:"AmountLastUpdateTime"`  // 金额最近一次更新时间
	TransferTransactionId int64         `bson:"TransferTransactionId"` // 当前正在交易的交易Id
	CreateTime            int64         `bson:"CreateTime"`            // 创建时间
	UpdateTime            int64         `bson:"UpdateTime"`            // 更新时间
}

````

函数注释规范
````
/*
	func:完成链上提交的回调
	parameters:
		coinId:币种Id
		walletId:钱包Id
		transactionId:交易Id
		sourceChainAccountAddr:交易发起方地址
		resultCode:提交结果
		transactionHash:交易Hash
	returns:
		transactionObj:交易对象
		handled:是否有处理过此项
		code:结果状态
*/
func FinishCommit(coinId uint32, walletId int32, transactionId int64, sourceChainAccountAddr string, resultCode transaction.CommitResultCode, transactionHash string) (transactionObj *transaction.TransactionModel, handled bool, code *enum.StateCode){

	return
}
````
* 每个外部可访问的函数必须要有`func`说明
* *外部不可访问的函数可以根据实际情况，自己认为函数名不能说明含义的可以添加函数的注释*。建议是每个函数都加上注释

其他注释
````
const _Name="nihao" // 常量的注释

/*
	性别
*/
type Sex int
const (
	Sex_Man   Sex = 1 // 男
	Sex_Woman Sex = 2 // 女
)
````
说明:
 * 枚举值尽量都放在同一个const块内


# 函数其他规范
````
/*
	func:提交链上失败的处理逻辑
	parameters:
		transactionObj:交易对象
		resultCode:结果状态
		transactionHash:提交的hash值
	returns:
		code:结果状态
*/
func OnCommitFail(transactionObj *transaction.TransactionModel, resultCode transaction.CommitResultCode, transactionHash string) (code *enum.StateCode) {
	// 如果提交失败，则解锁钱包 ---->对重要的逻辑添加必要的注释
	if resultCode == transaction.CommitResultCode_Success {
		code = enum.StateCode_Success
		return
	}

	modelObj, exist, err := GetItem2(transactionObj.CoinId, transactionObj.TransferWalletId)
	if err != nil {
		code = enum.StateCode_Error
		return
	}
	if exist == false {
		code = enum.StateCode_Wallet_WalletNoExist
		return nil
	} // -------------->代码按照逻辑完整必添加额外的空行进行分段

	if modelObj.TransferTransactionId != transactionObj.Id {
		code = enum.StateCode_Success
		return
	}

	_, err = _DalObj.UpdateCurrentTransferTransactionId(modelObj.Id, 0)
	if err != nil {
		code = enum.StateCode_Error
		return
	}

	code = enum.StateCode_Success
	return
}
````
说明:
 * 重要的代码段需要添加必要的注释说明
 * 不同逻辑块之间添加空行形成代码块，以便于整个代码结构更加清晰
 * 如果函数有多个返回值，按照(需要的有用结果，错误) 顺序排列，例如`func Hello()(name string,exist bool,err error)`
 * 如果函数有多个返回值，建议给每个返回值都进行命名
 * 不要重定义已存在的变量，否则有可能会出现同一个变量两个含义的情况，例如:
````
func Hello(){
	var name="nihao"
	name,exist:=_GetName() // 此处不建议使用：=。 因为有些情况下,name会进行对象的重新分配，导致你不知道name到底是不是之前的对象
	if exist{
		fmt.Println("name:",name)
	}else{
		fmt.Println("noname:",name)
	}
}
````

# 包规范

````
package wallet

func init(){
}

func GetData(coinId uint32, walletId int32) (modelObj *WalletModel, exist bool, err error){
}

func GetItem(coinId uint32, walletId int32) (modelObj *WalletModel, exist bool, err error){
}

func Hello(){
}
````

说明:
 * 包内按照功能进行文件划分，文件别需要体现出内容的含义
 * 文件内的内容建议按照如下顺序编写代码: const定义 var定义 struct定义 init函数 struct成员函数 非struct成员函数

# error规范
error需要在产生error的地方记录对应日志,外层调用一般不用记录日志，如有特殊需要可以记录日志。如果是业务预期error 则添加error处理就好，可以不记录日志.例如:
````
/*
	func:获取名称
*/
func _GetName()(name string,err error){
	err=fmt.Errorf("error") // 在error产生的地方记录日志
	return
}

func main(){
	name,err:=_GetName() // 外部不用记录日志
	if err!=nil{
		fmt.Println("error")
		return
	}
	
	fmt.Println("name:",name)
}

````