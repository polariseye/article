grpc与thrift造型调研
--------------------------------

测试源码:[点此下载测试源码](testCode-grpcVSthrift.zip)
测试环境:
	CPU: AMD Ryzen 5 3600 6-Core Processor
	内存:8G 

# thrift测试结论
测试数据

序号|测试方式|调用次数 | 总耗时（微秒） |  每次耗时（微秒）
-|-|-|-|-|
1|单协程单连接|100000|14048860|140
2|单协程单连接|100000|14188465|141
3|两个连接两个协程|100000|14464847|147
4|两个连接两个协程|100000|18308361|183
5|两个连接两个协程|100000|13990172|139
6|两个连接两个协程|100000|20603146|206
7|两个连接两个协程|100000|17846205|178

**缺点**
1. golang代码并不完整（核心基础功能是完整的），只有简单的API方式

2. 非协程安全，一个连接对象多个协程同时请求两个协程都会报错

3. 接口只支持同步调用，不支持异步调用

4. 没有开源现成的网关实现（thrift如果使用HTTP作为底层通信，可以使用nginx或者haproxy进行通信）

5. golang版本的暂不支持binary类型（专门用于传输字节数据） 

6. 代码注释少

7. 官方使用文档和原理文档都不完善  

**优点**

1. 服务器端可以并发接口调用

2. 有代码分层明显，每层都可以自己定制实现 



# grpc测试结论

测试数据:

序号|测试方式|调用次数 | 总耗时（微秒） |  每次耗时（微秒）
-|-|-|-|-|
1|单协程|100000|6819543|68|
2|单协程|100000|6918069|69|
3|单连接两协程|100000|7663721|76|
4|单连接两协程|100000|7851946|78|
5|单连接两协程|100000|7945941|79|
6|单连接两协程|100000|8451701|84|
7|两个连接两协程|100000|8077322|80|
8|两个连接两协程|100000|8227856|82|
9|两个连接两协程|100000|8404888|84|

**缺点**
1. 不支持异步
2. 如果一个连接被多个协程共用，则网络波动会同时影响相关的所有连接
3. 不支持

**优点**
1. 连接是协程安全的，同一个连接可以同时被多个协程使用
2. google有开源对应的的网关实现
3. 官方文档非常完善
4. 支持字节数组bytes


 